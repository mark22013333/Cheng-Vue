<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.cheng.shop.mapper.ShopPageBlockMapper">

    <resultMap type="com.cheng.shop.domain.ShopPageBlock" id="ShopPageBlockResult">
        <id     property="blockId"    column="block_id"/>
        <result property="pageKey"    column="page_key"/>
        <result property="blockKey"   column="block_key"/>
        <result property="blockType"  column="block_type"/>
        <result property="title"      column="title"/>
        <result property="subTitle"   column="sub_title"/>
        <result property="content"    column="content"/>
        <result property="imageUrl"   column="image_url"/>
        <result property="extraConfig" column="extra_config"/>
        <result property="sort"       column="sort_order"/>
        <result property="status"     column="status"/>
        <result property="createTime" column="create_time"/>
        <result property="updateTime" column="update_time"/>
    </resultMap>

    <sql id="selectBlockVo">
        select block_id, page_key, block_key, block_type, title, sub_title, content, image_url, extra_config, sort_order, status, create_time, update_time
        from shop_page_block
    </sql>

    <select id="selectBlockList" parameterType="com.cheng.shop.domain.ShopPageBlock" resultMap="ShopPageBlockResult">
        <include refid="selectBlockVo"/>
        <where>
            <if test="pageKey != null and pageKey != ''">
                AND page_key = #{pageKey}
            </if>
            <if test="blockKey != null and blockKey != ''">
                AND block_key like concat('%', #{blockKey}, '%')
            </if>
            <if test="blockType != null and blockType != ''">
                AND block_type = #{blockType}
            </if>
            <if test="status != null and status != ''">
                AND status = #{status}
            </if>
        </where>
        order by sort_order asc, block_id asc
    </select>

    <select id="selectBlockById" parameterType="Long" resultMap="ShopPageBlockResult">
        <include refid="selectBlockVo"/>
        where block_id = #{blockId}
    </select>

    <select id="selectBlockByPageAndKey" resultMap="ShopPageBlockResult">
        <include refid="selectBlockVo"/>
        where page_key = #{pageKey} and block_key = #{blockKey}
    </select>

    <insert id="insertBlock" parameterType="com.cheng.shop.domain.ShopPageBlock" useGeneratedKeys="true" keyProperty="blockId">
        insert into shop_page_block
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="pageKey != null and pageKey != ''">page_key,</if>
            <if test="blockKey != null and blockKey != ''">block_key,</if>
            <if test="blockType != null and blockType != ''">block_type,</if>
            <if test="title != null">title,</if>
            <if test="subTitle != null">sub_title,</if>
            <if test="content != null">content,</if>
            <if test="imageUrl != null">image_url,</if>
            <if test="extraConfig != null">extra_config,</if>
            <if test="sort != null">sort_order,</if>
            <if test="status != null and status != ''">status,</if>
            create_time
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="pageKey != null and pageKey != ''">#{pageKey},</if>
            <if test="blockKey != null and blockKey != ''">#{blockKey},</if>
            <if test="blockType != null and blockType != ''">#{blockType},</if>
            <if test="title != null">#{title},</if>
            <if test="subTitle != null">#{subTitle},</if>
            <if test="content != null">#{content},</if>
            <if test="imageUrl != null">#{imageUrl},</if>
            <if test="extraConfig != null">#{extraConfig},</if>
            <if test="sort != null">#{sort},</if>
            <if test="status != null and status != ''">#{status},</if>
            now()
        </trim>
    </insert>

    <update id="updateBlock" parameterType="com.cheng.shop.domain.ShopPageBlock">
        update shop_page_block
        <trim prefix="SET" suffixOverrides=",">
            <if test="blockType != null and blockType != ''">block_type = #{blockType},</if>
            <if test="title != null">title = #{title},</if>
            <if test="subTitle != null">sub_title = #{subTitle},</if>
            <if test="content != null">content = #{content},</if>
            <if test="imageUrl != null">image_url = #{imageUrl},</if>
            <if test="extraConfig != null">extra_config = #{extraConfig},</if>
            <if test="sort != null">sort_order = #{sort},</if>
            <if test="status != null and status != ''">status = #{status},</if>
            update_time = now()
        </trim>
        where block_id = #{blockId}
    </update>

    <delete id="deleteBlockById" parameterType="Long">
        delete from shop_page_block where block_id = #{blockId}
    </delete>

    <select id="checkBlockKeyUnique" resultType="int">
        select count(*) from shop_page_block where page_key = #{pageKey} and block_key = #{blockKey}
        <if test="blockId != null and blockId > 0">
            and block_id != #{blockId}
        </if>
    </select>

</mapper>
